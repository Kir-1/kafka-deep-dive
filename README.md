# Kafka

–≠—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ-–ø–µ—Å–æ—á–Ω–∏—Ü–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π Kafka (–ø–∞—Ä—Ç–∏—Ü–∏–∏, consumer groups, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å)

---

## –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω—ã –ø–∞—Ä—Ç–∏—Ü–∏–∏ –≤ Kafka?

–ü–∞—Ä—Ç–∏—Ü–∏–∏ (partitions) ‚Äî —ç—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤ Apache Kafka, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.


### **1. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (Scalability & Parallelism)** üöÄ

–ü–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç [—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∫–∞–∫ –Ω–∞ —á—Ç–µ–Ω–∏–µ, —Ç–∞–∫ –∏ –Ω–∞ –∑–∞–ø–∏—Å—å](https://kafka.apache.org/documentation/#intro_topics).

-   **–î–ª—è –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π (Consumers):**
    -   Kafka –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è-–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π `consumer group`. Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏.
    -   –ï—Å–ª–∏ —É –≤–∞—Å —Ç–æ–ø–∏–∫ —Å 4 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–æ 4 –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ, –∏ –∫–∞–∂–¥—ã–π –±—É–¥–µ—Ç —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–≤–æ–µ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ **–≤ 4 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ**.
    > üí° **–í–∞–∂–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π –≤ —Ç–æ–ø–∏–∫–µ. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –±–æ–ª—å—à–µ, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑ –Ω–∏—Ö –±—É–¥—É—Ç –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—Ç—å –≤ –æ–∂–∏–¥–∞–Ω–∏–∏.

-   **–î–ª—è –±—Ä–æ–∫–µ—Ä–æ–≤ (Brokers):**
    -   –ü–∞—Ä—Ç–∏—Ü–∏–∏ –æ–¥–Ω–æ–≥–æ —Ç–æ–ø–∏–∫–∞ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º (–±—Ä–æ–∫–µ—Ä–∞–º) –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ Kafka. –≠—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ –ø–æ –≤—Å–µ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É, –∞ –Ω–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç –µ–µ –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ.

### **2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (Performance)** ‚ö°

-   –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –ø–æ —Ä–∞–∑–Ω—ã–º –±—Ä–æ–∫–µ—Ä–∞–º –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å –¥–∏—Å–∫–æ–≤—ã–π –≤–≤–æ–¥-–≤—ã–≤–æ–¥.
-   –ö–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –≤ "–±—É—Ç—ã–ª–æ—á–Ω–æ–µ –≥–æ—Ä–ª—ã—à–∫–æ".
-   –ó–∞–ø–∏—Å—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ä—Ç–∏—Ü–∏–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –º–∞—à–∏–Ω–∞—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ–±—â—É—é –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (`throughput`) –Ω–∞ –∑–∞–ø–∏—Å—å.

### **3. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (Fault Tolerance)** üõ°Ô∏è

-   –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å [**—Ä–µ–ø–ª–∏–∫–∏ (replicas)**](https://kafka.apache.org/documentation/#replication). –≠—Ç–æ –∫–æ–ø–∏–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö.
-   –û–¥–Ω–∞ –∏–∑ —Ä–µ–ø–ª–∏–∫ —è–≤–ª—è–µ—Ç—Å—è **–ª–∏–¥–µ—Ä–æ–º (leader)** ‚Äî –æ–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å.
-   –û—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è–º–∏ (followers)**, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Å—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ —Å –ª–∏–¥–µ—Ä–∞.


–ï—Å–ª–∏ –±—Ä–æ–∫–µ—Ä —Å –ø–∞—Ä—Ç–∏—Ü–∏–µ–π-–ª–∏–¥–µ—Ä–æ–º –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å—Ç—Ä–æ—è, Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –∏–∑ —á–∏—Å–ª–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–π. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –±–µ–∑ –ø–æ—Ç–µ—Ä—å.

---

## [–ü–æ—á–µ–º—É "1 —Ç–æ–ø–∏–∫ —Å N –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏" –∏ "N —Ç–æ–ø–∏–∫–æ–≤ —Å 1 –ø–∞—Ä—Ç–∏—Ü–∏–µ–π" –Ω–µ –≤–∑–∞–∏–º–æ–∑–∞–º–µ–Ω—è–µ–º—ã?](https://martin.kleppmann.com/2018/01/18/event-types-in-kafka-topic.html)

*   üß† **–¢–æ–ø–∏–∫–∏** ‚Äî –¥–ª—è **–õ–û–ì–ò–ß–ï–°–ö–û–ì–û** —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
    -   –û–Ω–∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å **"–ß–¢–û"** —ç—Ç–æ –∑–∞ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `orders`, `clicks`, `user-activity`). –≠—Ç–æ —É—Ä–æ–≤–µ–Ω—å –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω–∞.

*   ‚öôÔ∏è **–ü–∞—Ä—Ç–∏—Ü–∏–∏** ‚Äî –¥–ª—è **–§–ò–ó–ò–ß–ï–°–ö–û–ì–û** –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏—è.
    -   –û–Ω–∏ –æ—Ç–≤–µ—á–∞—é—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å **"–ö–ê–ö"** —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –≠—Ç–æ —É—Ä–æ–≤–µ–Ω—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

> ### **–ê–Ω–∞–ª–æ–≥–∏—è: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞** üìö
>
> -   **–¢–æ–ø–∏–∫** ‚Äî —ç—Ç–æ –∫–∞–∫ –æ—Ç–¥–µ–ª –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ: "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ò—Å—Ç–æ—Ä–∏—è", "–ù–∞—É—á–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞". –≠—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–º—ã—Å–ª—É. –í—ã –∏–¥–µ—Ç–µ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ—Ç–¥–µ–ª –∑–∞ –∫–Ω–∏–≥–æ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏.
>
> -   **–ü–∞—Ä—Ç–∏—Ü–∏—è** ‚Äî —ç—Ç–æ –∫–∞–∫ –∫–Ω–∏–∂–Ω–∞—è –ø–æ–ª–∫–∞ –≤–Ω—É—Ç—Ä–∏ –æ—Ç–¥–µ–ª–∞. –ï—Å–ª–∏ –≤ –æ—Ç–¥–µ–ª–µ "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞" –æ—á–µ–Ω—å –º–Ω–æ–≥–æ –∫–Ω–∏–≥, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –æ—Ç–¥–µ–ª—ã "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞-2", "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞-3". –û–Ω–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç –Ω–æ–≤—ã–µ –ø–æ–ª–∫–∏ (–ø–∞—Ä—Ç–∏—Ü–∏–∏) –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –æ—Ç–¥–µ–ª–∞, —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏ –∏ —á—Ç–æ–±—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π (`consumers`) –º–æ–≥–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—Ä–∞—Ç—å –∫–Ω–∏–≥–∏ —Å —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª–æ–∫.



## [–ö–∞–∫ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ](https://medium.com/@asishpanda444/kafka-a-deep-dive-437e3cf48313)


### 1. –ë—Ä–æ–∫–µ—Ä: –§–∏–∑–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ –¥–∏—Å–∫–µ

**–ë—Ä–æ–∫–µ—Ä (Broker)** ‚Äî —ç—Ç–æ, –ø–æ —Å—É—Ç–∏, –ø—Ä–æ—Å—Ç–æ —Å–µ—Ä–≤–µ—Ä —Å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º Kafka (Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ). –ï–≥–æ –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö –Ω–∞ –¥–∏—Å–∫ –∏ –æ—Ç–¥–∞–≤–∞—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º.

–ù–∞ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ –±—Ä–æ–∫–µ—Ä –æ–ø–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º–∏ "—Ç–æ–ø–∏–∫–∞–º–∏", –∞ **—Ñ–∞–π–ª–∞–º–∏ –Ω–∞ –¥–∏—Å–∫–µ**.

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Kafka –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `log.dirs`, –∫–æ—Ç–æ—Ä—ã–π —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –≥–¥–µ –±—É–¥—É—Ç [—Ö—Ä–∞–Ω–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ](https://kafka.apache.org/documentation/#persistence).

*   **–ü–∞—Ä—Ç–∏—Ü–∏—è –Ω–∞ –¥–∏—Å–∫–µ ‚Äî —ç—Ç–æ –ø–∞–ø–∫–∞.** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–ø–∏–∫–∞ `my-topic` —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏, –∏ –æ–¥–Ω–∞ –∏–∑ –Ω–∏—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä—Ç–∏—Ü–∏—è `0`) –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —ç—Ç–æ—Ç –±—Ä–æ–∫–µ—Ä, –Ω–∞ –¥–∏—Å–∫–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–∞–ø–∫–∞ —Å –∏–º–µ–Ω–µ–º `my-topic-0`.
*   **–í–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ ‚Äî —Å–µ–≥–º–µ–Ω—Ç—ã –ª–æ–≥–∞.** Kafka –Ω–µ –ø–∏—à–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–∏–Ω –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Ñ–∞–π–ª. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –ª–æ–≥ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ **—Å–µ–≥–º–µ–Ω—Ç—ã (segment files)**. –≠—Ç–æ –æ–±—ã—á–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `.log`. –ö–æ–≥–¥–∞ –æ–¥–∏–Ω —Å–µ–≥–º–µ–Ω—Ç –¥–æ—Å—Ç–∏–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 –ì–ë) –∏–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è, Kafka –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –µ–≥–æ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–∏—Å–∞—Ç—å –≤ –Ω–æ–≤—ã–π.
*   **–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞.** –†—è–¥–æ–º —Å –∫–∞–∂–¥—ã–º —Ñ–∞–π–ª–æ–º-—Å–µ–≥–º–µ–Ω—Ç–æ–º (`.log`) –ª–µ–∂–∞—Ç —Ñ–∞–π–ª—ã-–∏–Ω–¥–µ–∫—Å—ã (`.index` –∏ `.timeindex`). –û–Ω–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ "—Å–º–µ—â–µ–Ω–∏–µ (offset) -> –ø–æ–∑–∏—Ü–∏—è –≤ —Ñ–∞–π–ª–µ". –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç Kafka –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –µ–≥–æ —Å–º–µ—â–µ–Ω–∏—é, –Ω–µ —Å–∫–∞–Ω–∏—Ä—É—è –≤–µ—Å—å —Ñ–∞–π–ª —Ü–µ–ª–∏–∫–æ–º.

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
*   **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –Ω–∞ –¥–∏—Å–∫–µ ‚Äî —ç—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –±—ã—Å—Ç—Ä—ã–º —Å–ø–æ—Å–æ–±–æ–º —Ä–∞–±–æ—Ç—ã —Å –∂–µ—Å—Ç–∫–∏–º–∏ –¥–∏—Å–∫–∞–º–∏.
*   **–£–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å:** –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç—ã –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã-—Å–µ–≥–º–µ–Ω—Ç—ã), —Ä–µ–∞–ª–∏–∑—É—è –ø–æ–ª–∏—Ç–∏–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è (log retention).

---

### 2. –¢–æ–ø–∏–∫–∏ –∏ –ü–∞—Ä—Ç–∏—Ü–∏–∏:

*   **–¢–æ–ø–∏–∫** ‚Äî —ç—Ç–æ –æ–±—â–µ–∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–µ –∏–º—è –¥–ª—è –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö (`orders`, `user-clicks`). –≠—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, —Å –∫–æ—Ç–æ—Ä–æ–π —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø—Ä–æ–¥—é—Å–µ—Ä—ã –∏ –∫–æ–Ω—Å—å—é–º–µ—Ä—ã).
*   **–ü–∞—Ä—Ç–∏—Ü–∏–∏** ‚Äî —ç—Ç–æ —Ç–æ, –∫–∞–∫ —ç—Ç–æ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–æ–ø–∏–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ 3 –±—Ä–æ–∫–µ—Ä–æ–≤ –∏ –º—ã —Å–æ–∑–¥–∞–µ–º **`Topic-A` —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏ —Ñ–∞–∫—Ç–æ—Ä–æ–º —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ 2**.

–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –Ω–∞ –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ:
1.  Kafka –≤—ã–±–µ—Ä–µ—Ç, –Ω–∞ –∫–∞–∫–∏—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ø–∞—Ä—Ç–∏—Ü–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä:
    *   **–ü–∞—Ä—Ç–∏—Ü–∏—è 0 (P0):** –õ–∏–¥–µ—Ä –Ω–∞ –ë—Ä–æ–∫–µ—Ä–µ 1, —Ä–µ–ø–ª–∏–∫–∞ –Ω–∞ –ë—Ä–æ–∫–µ—Ä–µ 2.
    *   **–ü–∞—Ä—Ç–∏—Ü–∏—è 1 (P1):** –õ–∏–¥–µ—Ä –Ω–∞ –ë—Ä–æ–∫–µ—Ä–µ 2, —Ä–µ–ø–ª–∏–∫–∞ –Ω–∞ –ë—Ä–æ–∫–µ—Ä–µ 3.
    *   **–ü–∞—Ä—Ç–∏—Ü–∏—è 2 (P2):** –õ–∏–¥–µ—Ä –Ω–∞ –ë—Ä–æ–∫–µ—Ä–µ 3, —Ä–µ–ø–ª–∏–∫–∞ –Ω–∞ –ë—Ä–æ–∫–µ—Ä–µ 1.

2.  –ù–∞ –¥–∏—Å–∫–∞—Ö —ç—Ç–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤ –ø–æ—è–≤—è—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞–ø–∫–∏:
    *   –ë—Ä–æ–∫–µ—Ä 1: –ø–∞–ø–∫–∏ `Topic-A-0` –∏ `Topic-A-2`.
    *   –ë—Ä–æ–∫–µ—Ä 2: –ø–∞–ø–∫–∏ `Topic-A-1` –∏ `Topic-A-0`.
    *   –ë—Ä–æ–∫–µ—Ä 3: –ø–∞–ø–∫–∏ `Topic-A-2` –∏ `Topic-A-1`.

**–õ–∏–¥–µ—Ä (Leader):** –¢–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏. –†–µ–ø–ª–∏–∫–∏ (followers) –ø–∞—Å—Å–∏–≤–Ω–æ –∫–æ–ø–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ —Å –ª–∏–¥–µ—Ä–∞.

---

### 3. [Offset (—Å–º–µ—â–µ–Ω–∏–µ)](https://stackoverflow.com/questions/53753415/what-is-this-topic-consumer-offsets-in-kafka)

Offset ‚Äî —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π, –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–∏–π –Ω–æ–º–µ—Ä (ID), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏**. –°–æ–æ–±—â–µ–Ω–∏–µ —Å offset `10` –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏ `0` –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å offset `10` –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏ `1` ‚Äî —ç—Ç–æ –¥–≤–∞ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Ä–∞–∑–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è. Offset ‚Äî —ç—Ç–æ, –ø–æ —Å—É—Ç–∏, –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–π–ª–µ-–ª–æ–≥–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏.

–ï—Å—Ç—å –¥–≤–∞ "–≤–∏–¥–∞" offset:
1.  **Offset —Å–æ–æ–±—â–µ–Ω–∏—è:** –ü–æ–∑–∏—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏. –û–Ω —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è –∏ **–Ω–µ–∏–∑–º–µ–Ω—è–µ–º**.
2.  **Offset –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (Consumer Group Offset):** "–ó–∞–∫–ª–∞–¥–∫–∞", –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π. –ò–º–µ–Ω–Ω–æ –µ–≥–æ –∏ –∫–æ–º–º–∏—Ç—è—Ç (—Å–æ—Ö—Ä–∞–Ω—è—é—Ç) –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏.

> Offset –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è —Ö—Ä–∞–Ω–∏—Ç—Å—è **–¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ** –≤ —Ä–∞–∑—Ä–µ–∑–µ –æ–¥–Ω–æ–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–æ–π –≥—Ä—É–ø–ø—ã (consumer group).

–ù–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –µ–¥–∏–Ω–æ–≥–æ offset'–∞ –¥–ª—è –≤—Å–µ–≥–æ —Ç–æ–ø–∏–∫–∞. –≠—Ç–æ –±—ã–ª–æ –±—ã –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —á–∏—Ç–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏ (–≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã) —Å —Ä–∞–∑–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é.

#### –ü—Ä–∏–º–µ—Ä:

–î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å:
*   `Topic-A` —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ (P0, P1, P2).
*   –ì—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π `group_id = 4`.
*   –í —ç—Ç–æ–π –≥—Ä—É–ø–ø–µ –∑–∞–ø—É—â–µ–Ω–æ 3 –∏–Ω—Å—Ç–∞–Ω—Å–∞ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è-–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è (C1, C2, C3).

Kafka —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Ç–∞–∫:
*   –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å C1 —á–∏—Ç–∞–µ—Ç –∏–∑ `P0`.
*   –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å C2 —á–∏—Ç–∞–µ—Ç –∏–∑ `P1`.
*   –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å C3 —á–∏—Ç–∞–µ—Ç –∏–∑ `P2`.

–°–æ—Å—Ç–æ—è–Ω–∏–µ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è) –¥–ª—è –≥—Ä—É–ø–ø—ã `group_id = 4` –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

| Consumer Group | Topic | Partition | Last Committed Offset |
| :--- | :--- | :--- | :--- |
| `group_id = 4` | `Topic-A` | `0` | `1540` |
| `group_id = 4` | `Topic-A` | `1` | `1398` |
| `group_id = 4` | `Topic-A` | `2` | `1612` |


#### –ì–¥–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è —ç—Ç–æ—Ç offset –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è?

Kafka –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥—Ö–æ–¥ "—Å–æ–±–∞—á—å—è –µ–¥–∞" (dogfooding). –û—Ñ—Ñ—Å–µ—Ç—ã –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏—Ö –≥—Ä—É–ø–ø —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —Ç–æ–ø–∏–∫–µ Kafka, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **`__consumer_offsets`**.

–ö–æ–≥–¥–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `consumer.commit()`, –æ–Ω –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —ç—Ç–æ—Ç —Ç–æ–ø–∏–∫ `__consumer_offsets`.
*   **–ö–ª—é—á —Å–æ–æ–±—â–µ–Ω–∏—è:** `(group_id, topic_name, partition_number)`
*   **–ó–Ω–∞—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:** `offset_number`

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–º–µ—â–µ–Ω–∏–π —Ç–∞–∫–∏–º –∂–µ –Ω–∞–¥–µ–∂–Ω—ã–º –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º, –∫–∞–∫ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ã—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ—Ç —Ç–æ–ø–∏–∫ —Ç–æ–∂–µ –∏–º–µ–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è –ø–æ –∫–ª–∞—Å—Ç–µ—Ä—É. Kafka —Å–∞–º–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏–º.


